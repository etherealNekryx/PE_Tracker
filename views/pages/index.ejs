<!DOCTYPE html>
<html lang="en">
    <head>
        <title>PE Tracker</title>
        <meta charset="UTF-8">
    </head>
    <body>
        <h1>PE Tracker</h1>
        <% tasks.forEach(function(r) { %>
            <button id='<%= r.id %>'
                onClick='javascript:logTask(<%= r.id %>);'><%= r.name %></button>
        
        <% }); %>

        <script>
            let currentTaskID = null;
            let totalDuration = new Date();
            let StartDuration = new Date();
            let taskOn = false;
            
            const logTask = async function(id) {
                if (!taskOn) {
                    let start = new Date();
                    startDuration = start;
                    taskOn = true;
                } else {
                    let end = new Date();
                    totalDuration = end - startDuration;
                    let durationDif = new Date(totalDuration);
                    
                    let totalDurationHMS = "'+" + leadZero(durationDif.getUTCHours()) + ":" + leadZero(durationDif.getUTCMinutes()) + ":" + leadZero(durationDif.getUTCSeconds()) + "'";

                    taskOn = false;

                    console.log(totalDurationHMS);
                
                    const response = await fetch('/log', {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            users_id: -1,
                            students_id: -1,
                            tasks_id: id,
                            duration: totalDurationHMS
                        })
                    });
                    const result = await response.json();
                    console.log(result);
                    
                    

                    currentTaskId = id;
                }
            };
            function leadZero(n){
                if (n < 10) {
                    n = "0" + n;
                    
                }
                return n;
            }

        </script>
    </body>
</html>